//tealium universal tag - utag.65 ut4.0.202407240943, Copyright 2024 Tealium.com Inc. All Rights Reserved.
var utag_handle_criteo_userid=utag_handle_criteo_userid;try{(function(id,loader){var u={};utag.o[loader].sender[id]=u;if(utag.ut===undefined){utag.ut={};}
if(utag.ut.loader===undefined){u.loader=function(o){var b,c,l,a=document;if(o.type==='iframe'){b=a.createElement('iframe');o.attrs=o.attrs||{'height':'1','width':'1','style':'display:none'};for(l in utag.loader.GV(o.attrs)){b.setAttribute(l,o.attrs[l]);}b.setAttribute('src',o.src);}else if(o.type=='img'){utag.DB('Attach img: '+o.src);b=new Image();b.src=o.src;return;}else{b=a.createElement('script');b.language='javascript';b.type='text/javascript';b.async=1;b.charset='utf-8';for(l in utag.loader.GV(o.attrs)){b[l]=o.attrs[l];}b.src=o.src;}if(o.id){b.id=o.id};if(typeof o.cb=='function'){if(b.addEventListener){b.addEventListener('load',function(){o.cb()},false);}else{b.onreadystatechange=function(){if(this.readyState=='complete'||this.readyState=='loaded'){this.onreadystatechange=null;o.cb()}};}}l=o.loc||'head';c=a.getElementsByTagName(l)[0];if(c){utag.DB('Attach to '+l+': '+o.src);if(l=='script'){c.parentNode.insertBefore(b,c);}else{c.appendChild(b)}}}}else{u.loader=utag.ut.loader;}
if(utag.ut.typeOf===undefined){u.typeOf=function(e){return({}).toString.call(e).match(/\s([a-zA-Z]+)/)[1].toLowerCase();};}else{u.typeOf=utag.ut.typeOf;}
u.ev={'view':1};u.map={};u.extend=[];u.toBoolean=function(val){val=String(val)||'';return val===true||val.toLowerCase()==='true'||val.toLowerCase()==='on';};u.getVID=function(data_layer){return data_layer["cp.utag_main_v_id"]||data_layer["tealium_visitor_id"]||data_layer["ut.visitor_id"];};u.checkVID=function(data_layer,oncePerSession){var vid=u.getVID(data_layer);if(!vid){utag.DB(u.id+": Tag not fired: Visitor ID is undefined");return false;}
if(oncePerSession){if(utag.loader.RC("utag_main")["tag_session_65"]){utag.DB(u.id+": Tag not fired: Same session is detected");return false;}else{utag.loader.SC("utag_main",{"tag_session_65":"1;exp-session"});}}
return true;};u.send=function(utag_event,data_layer){if(u.ev[utag_event]||u.ev.all!==undefined){var a,b,c,d,e,f;a=utag_event;b=data_layer;if(!u.checkVID(data_layer))return;utag.DB('send:65');var qsp_delim='&';var kvp_delim='=';var defaultDaysBetweenSync=7;u.data={'base_url':'//gum.criteo.com/sync?','c':'11','r':'2','dc_base_url':'//datacloud.tealiumiq.com/vdata/i.gif?','event_url':'//collect.tealiumiq.com/event?','tealium_account':'propertyfinder','tealium_profile':'main','days_between_syncs':'','tealium_datasource':'06rpb6','use_event_endpoint':'false',"iab_v20_compliance":true,"tc_string":""};c=[];for(d in utag.loader.GV(u.map)){if(data_layer[d]!==undefined&&data_layer[d]!==''){e=u.map[d].split(',');for(f=0;f<e.length;f++){u.data[e[f]]=data_layer[d];}}}
if(u.data.iab_v20_compliance===true||u.data.iab_v20_compliance==="true"){if(typeof __tcfapi==="function"){__tcfapi("getTCData",2,function(tcData,success){if(success){u.data.tc_string+="gdpr=";if(tcData.gdprApplies===true){u.data.tc_string+="1";}else if(tcData.gdprApplies===false){u.data.tc_string+="0";}else{u.data.tc_string+=String(tcData.gdprApplies);}
u.data.tc_string+="&gdpr_consent="+tcData.tcString;execute_send();}});}else{var frame=window;var cmpFrame;var cmpCallbacks={};while(frame){try{if(frame.frames["__tcfapiLocator"]){cmpFrame=frame;break;}}catch(error){utag.DB(error);}
if(frame===window.top){break;}
frame=frame.parent;}
if(!cmpFrame){execute_send();}else{window.__tcfapi=function(cmd,version,callback,arg){var callId=String(Math.random());var msg={__tcfapiCall:{command:cmd,parameter:arg,version:version,callId:callId}};cmpCallbacks[callId]=callback;cmpFrame.postMessage(msg,"*");};window.tealiumiabPostMessageHandler=function(event){var json={};try{json=typeof event.data==="string"?JSON.parse(event.data):event.data;}catch(error){utag.DB(error);}
var payload=json.__tcfapiReturn;if(payload){if(typeof cmpCallbacks[payload.callId]==="function"){cmpCallbacks[payload.callId](payload.returnValue,payload.success);cmpCallbacks[payload.callId]=null;}}};window.addEventListener("message",tealiumiabPostMessageHandler,false);__tcfapi("getTCData",2,function(tcData,success){if(success){u.data.tc_string+="gdpr=";if(tcData.gdprApplies===true){u.data.tc_string+="1";}else if(tcData.gdprApplies===false){u.data.tc_string+="0";}else{u.data.tc_string+=String(tcData.gdprApplies);}
u.data.tc_string+="&gdpr_consent="+tcData.tcString;execute_send();}});}}}else{execute_send();}
function execute_send(){u.data.tealium_account=u.data.tealium_account||utag.cfg.utid.split('/')[0];u.data.tealium_profile=u.data.tealium_profile||utag.cfg.utid.split('/')[1];u.data.use_event_endpoint=u.toBoolean(u.data.use_event_endpoint);if(u.data.use_event_endpoint){u.data.dc_base_url=u.data.event_url;}
u.data.days_between_syncs=Number(u.data.days_between_syncs);if(!u.data.days_between_syncs){u.data.days_between_syncs=defaultDaysBetweenSync;}
utag_handle_criteo_userid=function(data){utag.DB('Criteo Cookie Match Response received.');if(typeof data.userid!=='string'||data.userid.length<=4){utag.DB('Criteo Cookie Match missing valid cookie id, exiting.');return;}
var g=[];g.push('tealium_vid'+kvp_delim+(u.getVID(data_layer)||utag.v_id));g.push('tealium_account'+kvp_delim+u.data.tealium_account);g.push('tealium_profile'+kvp_delim+u.data.tealium_profile);g.push('tealium_datasource'+kvp_delim+(u.data.datasource_key||''));g.push('criteo_user_id'+kvp_delim+data.userid);g.push('tealium_event'+kvp_delim+'criteo_cookie_sync');if(typeof data_layer['cp.trace_id']!='undefined'){g.push('tealium_trace_id'+kvp_delim+data_layer['cp.trace_id']);}
g.push('tealium_cookie_sync'+kvp_delim+'true');u.loader({'type':'img','src':u.data.dc_base_url+g.join(qsp_delim)});var localStorageSupported=window.localStorage!==undefined;if(localStorageSupported){localStorage.setItem('tealium_criteo_userid_sync',Date.now()+'_'+data.userid);}
utag.loader.SC('criteo_user_id',data.userid);utag.data['cp.criteo_user_id']=data.userid;utag.DB('Sent Criteo ID ('+data.userid+'), to CDH as separate event '+(localStorageSupported?'and persisted to localStorage.':'but couldn\'t persist to localStorage.'));};c.push('c'+kvp_delim+u.data.c);c.push('a'+kvp_delim+1);c.push('r'+kvp_delim+u.data.r);c.push('j'+kvp_delim+'utag_handle_criteo_userid');var fetch_userid=function(){u.loader({'type':'script','src':u.data.base_url+c.join(qsp_delim)});};if(typeof window.localStorage!==undefined){var criteo_sync_string=localStorage.getItem('tealium_criteo_userid_sync')||'';var sync_string_parts=criteo_sync_string.match(/(^\d{13})_(.*)$/);var sync_time=sync_string_parts&&parseInt(sync_string_parts[1],10);var sync_id=sync_string_parts&&sync_string_parts[2];var current_time=Date.now();var days_since_sync=sync_time&&current_time&&((current_time-sync_time)/1000/60/60/24);if(sync_string_parts&&days_since_sync&&u.data.days_between_syncs&&(days_since_sync<=parseInt(u.data.days_between_syncs,10))){utag.DB('Found fresh Criteo ID ('+sync_id+'), not refreshing or sending to CDH.');}else{utag.DB('Requesting Criteo Cookie ID (no fresh ID found in localStorage).');fetch_userid();}}else{utag.DB('Requesting Criteo Cookie ID (no localStorage support).');fetch_userid();}
utag.DB('send:65:COMPLETE');}}};utag.o[loader].loader.LOAD(id);}('65','propertyfinder.uae'));}catch(error){utag.DB(error);}
